/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};function e(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function n(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{s(r.next(t))}catch(t){a(t)}}function u(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}s((r=r.apply(t,e||[])).next())}))}function r(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}var i,a=function(){function t(t){void 0===t&&(t=1),this.concurrent=t,this.queue=[],this.running=0}return t.prototype.pump=function(){return n(this,void 0,void 0,(function(){var t,e,n;return r(this,(function(r){switch(r.label){case 0:if(this.running>=this.concurrent)return[2];if(!(t=this.queue.shift()))return[2];this.running++,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.fn()];case 2:return e=r.sent(),t.resolve(e),[3,4];case 3:return n=r.sent(),t.reject(n),[3,4];case 4:return this.running--,[2,this.pump()]}}))}))},t.prototype.add=function(t){var e=this;return new Promise((function(n,r){return e.queue.push({fn:t,resolve:n,reject:r}),e.pump()}))},t}(),o=function(){function t(t,e){this.service=t,this.emitter=e}return t.prototype.getCharacteristic=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return this.characteristics?[3,2]:(e=this,[4,this.service.getCharacteristics()]);case 1:e.characteristics=n.sent(),n.label=2;case 2:return[2,this.characteristics.find((function(e){return e.uuid===t}))]}}))}))},t.prototype.getCharacteristicValue=function(e){return n(this,void 0,void 0,(function(){var i,a=this;return r(this,(function(o){switch(o.label){case 0:return[4,this.getCharacteristic(e)];case 1:if(!(i=o.sent()))throw new Error("Unable to locate characteristic");return[4,t.queue.add((function(){return n(a,void 0,void 0,(function(){return r(this,(function(t){return[2,i.readValue()]}))}))}))];case 2:return[2,o.sent()]}}))}))},t.prototype.setCharacteristicValue=function(e,i){return n(this,void 0,void 0,(function(){var a,o=this;return r(this,(function(u){switch(u.label){case 0:return[4,this.getCharacteristic(e)];case 1:if(!(a=u.sent()))throw new Error("Unable to locate characteristic");return[4,t.queue.add((function(){return n(o,void 0,void 0,(function(){return r(this,(function(t){return[2,a.writeValue(i)]}))}))}))];case 2:return u.sent(),[2]}}))}))},t.prototype.handleListener=function(e,i,a){return n(this,void 0,void 0,(function(){var o,u=this;return r(this,(function(s){switch(s.label){case 0:return[4,this.getCharacteristic(i)];case 1:return(o=s.sent())?[4,t.queue.add((function(){return n(u,void 0,void 0,(function(){return r(this,(function(t){return[2,o.startNotifications()]}))}))}))]:[2];case 2:return s.sent(),this.emitter.on("newListener",(function(i){if(!(i!==e||u.emitter.listenerCount(e)>0))return t.queue.add((function(){return n(u,void 0,void 0,(function(){return r(this,(function(t){return[2,o.addEventListener("characteristicvaluechanged",a)]}))}))}))})),this.emitter.on("removeListener",(function(i){if(!(i!==e||u.emitter.listenerCount(e)>0))return t.queue.add((function(){return n(u,void 0,void 0,(function(){return r(this,(function(t){return[2,o.removeEventListener("characteristicvaluechanged",a)]}))}))}))})),[2]}}))}))},t.queue=new a,t}();!function(t){t.modelNumber="00002a24-0000-1000-8000-00805f9b34fb",t.serialNumber="00002a25-0000-1000-8000-00805f9b34fb",t.firmwareRevision="00002a26-0000-1000-8000-00805f9b34fb",t.hardwareRevision="00002a27-0000-1000-8000-00805f9b34fb",t.manufacturer="00002a29-0000-1000-8000-00805f9b34fb"}(i||(i={}));var u=function(){function t(t){this.helper=new o(t)}return t.create=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,new t(e)]}))}))},t.prototype.readDeviceInformation=function(){return n(this,void 0,void 0,(function(){var t,e,n,a,o,u;return r(this,(function(r){switch(r.label){case 0:return t={},[4,this.readStringCharacteristic(i.modelNumber)];case 1:return(e=r.sent())&&(t.modelNumber=e),[4,this.readStringCharacteristic(i.serialNumber)];case 2:return(n=r.sent())&&(t.serialNumber=n),[4,this.readStringCharacteristic(i.firmwareRevision)];case 3:return(a=r.sent())&&(t.firmwareRevision=a),[4,this.readStringCharacteristic(i.hardwareRevision)];case 4:return(o=r.sent())&&(t.hardwareRevision=o),[4,this.readStringCharacteristic(i.manufacturer)];case 5:return(u=r.sent())&&(t.manufacturer=u),[2,t]}}))}))},t.prototype.readStringCharacteristic=function(t){return n(this,void 0,void 0,(function(){var e,n;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.helper.getCharacteristicValue(t)];case 1:return e=r.sent(),n=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength),[2,String.fromCharCode.apply(null,Array.from(new Uint8Array(n)))];case 2:return r.sent(),[2,void 0];case 3:return[2]}}))}))},t.uuid="0000180a-0000-1000-8000-00805f9b34fb",t}();function s(){}function c(){c.init.call(this)}function h(t){return void 0===t._maxListeners?c.defaultMaxListeners:t._maxListeners}function f(t,e,n){if(e)t.call(n);else for(var r=t.length,i=y(t,r),a=0;a<r;++a)i[a].call(n)}function d(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,a=y(t,i),o=0;o<i;++o)a[o].call(n,r)}function l(t,e,n,r,i){if(e)t.call(n,r,i);else for(var a=t.length,o=y(t,a),u=0;u<a;++u)o[u].call(n,r,i)}function v(t,e,n,r,i,a){if(e)t.call(n,r,i,a);else for(var o=t.length,u=y(t,o),s=0;s<o;++s)u[s].call(n,r,i,a)}function p(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,a=y(t,i),o=0;o<i;++o)a[o].apply(n,r)}function g(t,e,n,r){var i,a,o,u;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),a=t._events),o=a[e]):(a=t._events=new s,t._eventsCount=0),o){if("function"==typeof o?o=a[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=h(t))&&i>0&&o.length>i){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,u=c,"function"==typeof console.warn?console.warn(u):console.log(u)}}else o=a[e]=n,++t._eventsCount;return t}function m(t,e,n){var r=!1;function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}return i.listener=n,i}function w(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function y(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}s.prototype=Object.create(null),c.EventEmitter=c,c.usingDomains=!1,c.prototype.domain=void 0,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.init=function(){this.domain=null,c.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new s,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},c.prototype.getMaxListeners=function(){return h(this)},c.prototype.emit=function(t){var e,n,r,i,a,o,u,s="error"===t;if(o=this._events)s=s&&null==o.error;else if(!s)return!1;if(u=this.domain,s){if(e=arguments[1],!u){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=u,e.domainThrown=!1,u.emit("error",e),!1}if(!(n=o[t]))return!1;var h="function"==typeof n;switch(r=arguments.length){case 1:f(n,h,this);break;case 2:d(n,h,this,arguments[1]);break;case 3:l(n,h,this,arguments[1],arguments[2]);break;case 4:v(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),a=1;a<r;a++)i[a-1]=arguments[a];p(n,h,this,i)}return!0},c.prototype.addListener=function(t,e){return g(this,t,e,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(t,e){return g(this,t,e,!0)},c.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,m(this,t,e)),this},c.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,m(this,t,e)),this},c.prototype.removeListener=function(t,e){var n,r,i,a,o;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new s:(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,a=n.length;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=n[a].listener,i=a;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new s,this;delete r[t]}else!function(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}(n,i);r.removeListener&&this.emit("removeListener",t,o||e)}return this},c.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new s,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new s:delete n[t]),this;if(0===arguments.length){for(var r,i=Object.keys(n),a=0;a<i.length;++a)"removeListener"!==(r=i[a])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new s,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},c.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},c.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):w.call(t,e)},c.prototype.listenerCount=w,c.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var b,C,V=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.isEventListenerObject=function(t){return void 0!==t.handleEvent},e}return e(n,t),n.prototype.addEventListener=function(e,n){if(n){var r=this.isEventListenerObject(n)?n.handleEvent:n;t.prototype.addListener.call(this,e,r)}},n.prototype.removeEventListener=function(e,n){if(n){var r=this.isEventListenerObject(n)?n.handleEvent:n;t.prototype.removeListener.call(this,e,r)}},n.prototype.dispatchEvent=function(e,n){var r;return r="string"==typeof e?new CustomEvent(e,{detail:n}):e,t.prototype.emit.call(this,r.type,r)},n}(c);!function(t){t.buttonAState="e95dda90-251d-470a-a062-fa1922dfa9a8",t.buttonBState="e95dda91-251d-470a-a062-fa1922dfa9a8"}(b||(b={})),function(t){t[t.Release=0]="Release",t[t.ShortPress=1]="ShortPress",t[t.LongPress=2]="LongPress"}(C||(C={}));var L,D=function(t){function i(e){var n=t.call(this)||this;return n.helper=new o(e,n),n}return e(i,t),i.create=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(e=new i(t)).init()];case 1:return n.sent(),[2,e]}}))}))},i.prototype.init=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.handleListener("buttonastatechanged",b.buttonAState,this.buttonAStateChangedHandler.bind(this))];case 1:return t.sent(),[4,this.helper.handleListener("buttonbstatechanged",b.buttonBState,this.buttonBStateChangedHandler.bind(this))];case 2:return t.sent(),[2]}}))}))},i.prototype.readButtonAState=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.getCharacteristicValue(b.buttonAState)];case 1:return[2,t.sent().getUint8(0)]}}))}))},i.prototype.readButtonBState=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.getCharacteristicValue(b.buttonBState)];case 1:return[2,t.sent().getUint8(0)]}}))}))},i.prototype.buttonAStateChangedHandler=function(t){var e=t.target.value;this.dispatchEvent("buttonastatechanged",e.getUint8(0))},i.prototype.buttonBStateChangedHandler=function(t){var e=t.target.value;this.dispatchEvent("buttonbstatechanged",e.getUint8(0))},i.uuid="e95d9882-251d-470a-a062-fa1922dfa9a8",i}(V);!function(t){t.ledMatrixState="e95d7b77-251d-470a-a062-fa1922dfa9a8",t.ledText="e95d93ee-251d-470a-a062-fa1922dfa9a8",t.scrollingDelay="e95d0d2d-251d-470a-a062-fa1922dfa9a8"}(L||(L={}));var S,E=function(){function t(t){this.helper=new o(t)}return t.create=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,new t(e)]}))}))},t.prototype.writeText=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return e=this.encodeString(t),[2,this.helper.setCharacteristicValue(L.ledText,e)]}))}))},t.prototype.readMatrixState=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this.helper.getCharacteristicValue(L.ledMatrixState)];case 1:return t=e.sent(),[2,this.viewToLedMatrix(t)]}}))}))},t.prototype.writeMatrixState=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return e=this.ledMatrixToView(t),[2,this.helper.setCharacteristicValue(L.ledMatrixState,e)]}))}))},t.prototype.getScrollingDelay=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.getCharacteristicValue(L.scrollingDelay)];case 1:return[2,t.sent().getUint16(0,!0)]}}))}))},t.prototype.setScrollingDelay=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return(e=new DataView(new ArrayBuffer(2))).setUint16(0,t,!0),[2,this.helper.setCharacteristicValue(L.scrollingDelay,e)]}))}))},t.prototype.encodeString=function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return e},t.prototype.viewToLedMatrix=function(t){for(var e=[],n=0;n<5;n++)e[n]=this.byteToBoolArray(t.getUint8(n));return e},t.prototype.byteToBoolArray=function(t){for(var e=[!1,!1,!1,!1,!1],n=0;n<e.length;n++)e[n]=1==(1&t),t>>=1;return e.reverse()},t.prototype.ledMatrixToView=function(t){for(var e=new DataView(new ArrayBuffer(5)),n=0;n<5;n++)e.setUint8(n,this.boolArrayToByte(t[n]));return e},t.prototype.boolArrayToByte=function(t){return t.reduce((function(t,e){return t<<1|(e?1:0)}),0)},t.uuid="e95dd91d-251d-470a-a062-fa1922dfa9a8",t}();!function(t){t.temperature="e95d9250-251d-470a-a062-fa1922dfa9a8",t.temperaturePeriod="e95d1b25-251d-470a-a062-fa1922dfa9a8"}(S||(S={}));var A,T=function(t){function i(e){var n=t.call(this)||this;return n.helper=new o(e,n),n}return e(i,t),i.create=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(e=new i(t)).init()];case 1:return n.sent(),[2,e]}}))}))},i.prototype.init=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.handleListener("temperaturechanged",S.temperature,this.temperatureChangedHandler.bind(this))];case 1:return t.sent(),[2]}}))}))},i.prototype.readTemperature=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.getCharacteristicValue(S.temperature)];case 1:return[2,t.sent().getInt8(0)]}}))}))},i.prototype.getTemperaturePeriod=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.getCharacteristicValue(S.temperaturePeriod)];case 1:return[2,t.sent().getUint16(0,!0)]}}))}))},i.prototype.setTemperaturePeriod=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return(e=new DataView(new ArrayBuffer(2))).setUint16(0,t,!0),[4,this.helper.setCharacteristicValue(S.temperaturePeriod,e)];case 1:return[2,n.sent()]}}))}))},i.prototype.temperatureChangedHandler=function(t){var e=t.target.value;this.dispatchEvent("temperaturechanged",e.getInt8(0))},i.uuid="e95d6100-251d-470a-a062-fa1922dfa9a8",i}(V);!function(t){t.accelerometerData="e95dca4b-251d-470a-a062-fa1922dfa9a8",t.accelerometerPeriod="e95dfb24-251d-470a-a062-fa1922dfa9a8"}(A||(A={}));var U,x,_=function(t){function i(e){var n=t.call(this)||this;return n.helper=new o(e,n),n}return e(i,t),i.create=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(e=new i(t)).init()];case 1:return n.sent(),[2,e]}}))}))},i.prototype.init=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.handleListener("accelerometerdatachanged",A.accelerometerData,this.accelerometerDataChangedHandler.bind(this))];case 1:return t.sent(),[2]}}))}))},i.prototype.readAccelerometerData=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this.helper.getCharacteristicValue(A.accelerometerData)];case 1:return t=e.sent(),[2,this.dataViewToAccelerometerData(t)]}}))}))},i.prototype.getAccelerometerPeriod=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.getCharacteristicValue(A.accelerometerPeriod)];case 1:return[2,t.sent().getUint16(0,!0)]}}))}))},i.prototype.setAccelerometerPeriod=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return(e=new DataView(new ArrayBuffer(2))).setUint16(0,t,!0),[2,this.helper.setCharacteristicValue(A.accelerometerPeriod,e)]}))}))},i.prototype.accelerometerDataChangedHandler=function(t){var e=t.target.value,n=this.dataViewToAccelerometerData(e);this.dispatchEvent("accelerometerdatachanged",n)},i.prototype.dataViewToAccelerometerData=function(t){return{x:t.getInt16(0,!0)/1e3,y:t.getInt16(2,!0)/1e3,z:t.getInt16(4,!0)/1e3}},i.uuid="e95d0753-251d-470a-a062-fa1922dfa9a8",i}(V);!function(t){t.magnetometerData="e95dfb11-251d-470a-a062-fa1922dfa9a8",t.magnetometerPeriod="e95d386c-251d-470a-a062-fa1922dfa9a8",t.magnetometerBearing="e95d9715-251d-470a-a062-fa1922dfa9a8",t.magnetometerCalibration="e95db358-251d-470a-a062-fa1922dfa9a8"}(U||(U={})),function(t){t[t.unknown=0]="unknown",t[t.requested=1]="requested",t[t.completed=2]="completed",t[t.errored=3]="errored"}(x||(x={}));var B,P=function(t){function i(e){var n=t.call(this)||this;return n.helper=new o(e,n),n}return e(i,t),i.create=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(e=new i(t)).init()];case 1:return n.sent(),[2,e]}}))}))},i.prototype.init=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.handleListener("magnetometerdatachanged",U.magnetometerData,this.magnetometerDataChangedHandler.bind(this))];case 1:return t.sent(),[4,this.helper.handleListener("magnetometerbearingchanged",U.magnetometerBearing,this.magnetometerBearingChangedHandler.bind(this))];case 2:return t.sent(),[4,this.helper.handleListener("magnetometercalibrationchanged",U.magnetometerCalibration,this.magnetometerCalibrationChangedHandler.bind(this))];case 3:return t.sent(),[2]}}))}))},i.prototype.calibrate=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){return[2,this.helper.setCharacteristicValue(U.magnetometerCalibration,new Uint8Array([1]))]}))}))},i.prototype.readMagnetometerData=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this.helper.getCharacteristicValue(U.magnetometerData)];case 1:return t=e.sent(),[2,this.dataViewToMagnetometerData(t)]}}))}))},i.prototype.readMagnetometerBearing=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this.helper.getCharacteristicValue(U.magnetometerBearing)];case 1:return 2===(t=e.sent()).byteLength?[2,t.getUint16(0,!0)]:[2,void 0]}}))}))},i.prototype.getMagnetometerPeriod=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.getCharacteristicValue(U.magnetometerPeriod)];case 1:return[2,t.sent().getUint16(0,!0)]}}))}))},i.prototype.setMagnetometerPeriod=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return(e=new DataView(new ArrayBuffer(2))).setUint16(0,t,!0),[2,this.helper.setCharacteristicValue(U.magnetometerPeriod,e)]}))}))},i.prototype.magnetometerDataChangedHandler=function(t){var e=t.target.value,n=this.dataViewToMagnetometerData(e);this.dispatchEvent("magnetometerdatachanged",n)},i.prototype.magnetometerBearingChangedHandler=function(t){var e=t.target.value;2===e.byteLength&&this.dispatchEvent("magnetometerbearingchanged",e.getUint16(0,!0))},i.prototype.magnetometerCalibrationChangedHandler=function(t){var e=t.target.value;1===e.byteLength&&this.dispatchEvent("magnetometercalibrationchanged",e.getUint8(0))},i.prototype.dataViewToMagnetometerData=function(t){return{x:t.getInt16(0,!0),y:t.getInt16(1,!0),z:t.getInt16(2,!0)}},i.uuid="e95df2d8-251d-470a-a062-fa1922dfa9a8",i}(V);!function(t){t.pinData="e95d8d00-251d-470a-a062-fa1922dfa9a8",t.pinAdConfiguration="e95d5899-251d-470a-a062-fa1922dfa9a8",t.pinIoConfiguration="e95db9fe-251d-470a-a062-fa1922dfa9a8",t.pwmControl="e95dd822-251d-470a-a062-fa1922dfa9a8"}(B||(B={}));var M,q;!function(t){t[t.Digital=0]="Digital",t[t.Analogue=1]="Analogue"}(M||(M={})),function(t){t[t.Output=0]="Output",t[t.Input=1]="Input"}(q||(q={}));var H,R=function(t){function i(e){var n=t.call(this)||this;return n.helper=new o(e,n),n}return e(i,t),i.create=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(e=new i(t)).init()];case 1:return n.sent(),[2,e]}}))}))},i.prototype.init=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.handleListener("pindatachanged",B.pinData,this.pinDataChangedHandler.bind(this))];case 1:return t.sent(),[2]}}))}))},i.prototype.readPinData=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this.helper.getCharacteristicValue(B.pinData)];case 1:return t=e.sent(),[2,this.dataViewToPinData(t)]}}))}))},i.prototype.writePinData=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return e=this.pinDataToDataView(t),[2,this.helper.setCharacteristicValue(B.pinData,e)]}))}))},i.prototype.getAdConfiguration=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this.helper.getCharacteristicValue(B.pinAdConfiguration)];case 1:return t=e.sent(),[2,this.dataViewToConfig(t)]}}))}))},i.prototype.setAdConfiguration=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return e=this.configToDataView(t),[2,this.helper.setCharacteristicValue(B.pinAdConfiguration,e)]}))}))},i.prototype.getIoConfiguration=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this.helper.getCharacteristicValue(B.pinIoConfiguration)];case 1:return t=e.sent(),[2,this.dataViewToConfig(t)]}}))}))},i.prototype.setIoConfiguration=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return e=this.configToDataView(t),[2,this.helper.setCharacteristicValue(B.pinIoConfiguration,e)]}))}))},i.prototype.setPwmControl=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return e=this.pwmControlDataToDataView(t),[2,this.helper.setCharacteristicValue(B.pwmControl,e)]}))}))},i.prototype.pinDataChangedHandler=function(t){var e=t.target.value,n=this.dataViewToPinData(e);this.dispatchEvent("pindatachanged",n)},i.prototype.dataViewToPinData=function(t){for(var e=[],n=0;n<t.byteLength;n+=2)e.push({pin:t.getUint8(n),value:t.getUint8(n+1)});return e},i.prototype.pinDataToDataView=function(t){var e=new DataView(new ArrayBuffer(2*t.length));return t.forEach((function(t,n){e.setUint8(2*n,t.pin),e.setUint8(2*n+1,t.value)})),e},i.prototype.dataViewToConfig=function(t){for(var e=[],n=(t.getUint16(0)<<8)+t.getUint8(2),r=0;r<24;r++)e.push(n>>r);return e},i.prototype.configToDataView=function(t){for(var e=new DataView(new ArrayBuffer(3)),n=0,r=0;r<t.length;r++)n&=1<<t[r];return e.setUint16(0,n>>8,true),e.setUint8(2,255&n),e},i.prototype.pwmControlDataToDataView=function(t){var e=new DataView(new ArrayBuffer(7));return e.setUint8(0,t.pin),e.setUint16(1,t.value,true),e.setUint32(3,t.period,true),e},i.uuid="e95d127b-251d-470a-a062-fa1922dfa9a8",i}(V);!function(t){t.tx="6e400002-b5a3-f393-e0a9-e50e24dcca9e",t.rx="6e400003-b5a3-f393-e0a9-e50e24dcca9e"}(H||(H={}));var I,O=function(t){function i(e){var n=t.call(this)||this;return n.helper=new o(e,n),n}return e(i,t),i.create=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(e=new i(t)).init()];case 1:return n.sent(),[2,e]}}))}))},i.prototype.init=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.handleListener("receive",H.tx,this.receiveHandler.bind(this))];case 1:return t.sent(),[4,this.helper.handleListener("receiveText",H.tx,this.receiveTextHandler.bind(this))];case 2:return t.sent(),[2]}}))}))},i.prototype.send=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,this.helper.setCharacteristicValue(H.rx,t)]}))}))},i.prototype.sendText=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return e=t.split("").map((function(t){return t.charCodeAt(0)})),[2,this.helper.setCharacteristicValue(H.rx,new Uint8Array(e).buffer)]}))}))},i.prototype.receiveHandler=function(t){var e=t.target.value,n=new Uint8Array(e.buffer);this.dispatchEvent("receive",n)},i.prototype.receiveTextHandler=function(t){var e=t.target.value,n=Array.prototype.slice.call(new Uint8Array(e.buffer)),r=String.fromCharCode.apply(null,n);this.dispatchEvent("receiveText",r)},i.uuid="6e400001-b5a3-f393-e0a9-e50e24dcca9e",i}(V);!function(t){t.microBitRequirements="e95db84c-251d-470a-a062-fa1922dfa9a8",t.microBitEvent="e95d9775-251d-470a-a062-fa1922dfa9a8",t.clientRequirements="e95d23c4-251d-470a-a062-fa1922dfa9a8",t.clientEvent="e95d5404-251d-470a-a062-fa1922dfa9a8"}(I||(I={}));var k,j=function(t){function i(e){var n=t.call(this)||this;return n.helper=new o(e,n),n}return e(i,t),i.create=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(e=new i(t)).init()];case 1:return n.sent(),[2,e]}}))}))},i.prototype.init=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.helper.handleListener("microbitevent",I.microBitEvent,this.eventHandler.bind(this))];case 1:return t.sent(),[4,this.helper.handleListener("microbitrequirementschanged",I.microBitRequirements,this.microbitRequirementsChangedHandler.bind(this))];case 2:return t.sent(),[2]}}))}))},i.prototype.getMicrobitRequirements=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this.helper.getCharacteristicValue(I.microBitRequirements)];case 1:return t=e.sent(),[2,this.viewToMicrobitEvent(t)]}}))}))},i.prototype.setClientRequirements=function(t,e){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return(n=new DataView(new ArrayBuffer(4))).setUint16(0,t,!0),n.setUint16(1,e,!0),[4,this.helper.setCharacteristicValue(I.clientRequirements,n)];case 1:return[2,r.sent()]}}))}))},i.prototype.readMicrobitEvent=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,this.helper.getCharacteristicValue(I.microBitEvent)];case 1:return t=e.sent(),[2,this.viewToMicrobitEvent(t)]}}))}))},i.prototype.writeClientEvent=function(t,e){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return(n=new DataView(new ArrayBuffer(4))).setUint16(0,t,!0),n.setUint16(1,e,!0),[4,this.helper.setCharacteristicValue(I.clientEvent,n)];case 1:return[2,r.sent()]}}))}))},i.prototype.microbitRequirementsChangedHandler=function(t){var e=t.target.value,n=this.viewToMicrobitEvent(e);this.dispatchEvent("microbitrequirementschanged",n)},i.prototype.eventHandler=function(t){var e=t.target.value,n=this.viewToMicrobitEvent(e);this.dispatchEvent("microbitevent",n)},i.prototype.viewToMicrobitEvent=function(t){return{type:t.getUint16(0,!0),value:t.getUint16(1,!0)}},i.uuid="e95d93af-251d-470a-a062-fa1922dfa9a8",i}(V);!function(t){t.dfuControl="e95d93b1-251d-470a-a062-fa1922dfa9a8"}(k||(k={}));var N=function(){function t(t){this.helper=new o(t)}return t.create=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,new t(e)]}))}))},t.prototype.requestDfu=function(){return this.helper.setCharacteristicValue(k.dfuControl,new Uint8Array([1]))},t.prototype.requestFlashCode=function(){return this.helper.setCharacteristicValue(k.dfuControl,new Uint8Array([2]))},t.uuid="e95d93b0-251d-470a-a062-fa1922dfa9a8",t}(),z=function(){function t(t){this.services=t}return t.prototype.createService=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return(e=this.services.find((function(e){return e.uuid===t.uuid})))?[4,t.create(e)]:[2,void 0];case 1:return[2,n.sent()]}}))}))},t}(),F=function(t){return n(void 0,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,t.requestDevice({filters:[{namePrefix:"BBC micro:bit"}],optionalServices:[u.uuid,D.uuid,E.uuid,T.uuid,_.uuid,P.uuid,R.uuid,O.uuid,j.uuid,N.uuid]})];case 1:return[2,e.sent()]}}))}))},G=function(t){return n(void 0,void 0,void 0,(function(){var e,n,i,a,o,s,c,h,f,d,l,v;return r(this,(function(r){switch(r.label){case 0:return t&&t.gatt?t.gatt.connected?[3,2]:[4,t.gatt.connect()]:[2,{}];case 1:r.sent(),r.label=2;case 2:return[4,t.gatt.getPrimaryServices()];case 3:return e=r.sent(),[4,(n=new z(e)).createService(u)];case 4:return i=r.sent(),[4,n.createService(D)];case 5:return a=r.sent(),[4,n.createService(E)];case 6:return o=r.sent(),[4,n.createService(T)];case 7:return s=r.sent(),[4,n.createService(_)];case 8:return c=r.sent(),[4,n.createService(P)];case 9:return h=r.sent(),[4,n.createService(O)];case 10:return f=r.sent(),[4,n.createService(j)];case 11:return d=r.sent(),[4,n.createService(N)];case 12:return l=r.sent(),[4,n.createService(R)];case 13:return v=r.sent(),[2,{deviceInformationService:i,buttonService:a,ledService:o,temperatureService:s,accelerometerService:c,magnetometerService:h,uartService:f,eventService:d,dfuControlService:l,ioPinService:v}]}}))}))};export{G as getServices,F as requestMicrobit};
//# sourceMappingURL=microbit.esm.js.map
